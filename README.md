# Тестовое задание на создание OCR для ценников

## Быстрый старт

### Установка на Linux

1. **Создание виртуального окружения:**
    Для начала создайте виртуальное окружение и активируйте его:
    ```bash
    python -m venv venv  # Создание виртуального окружения
    source venv/bin/activate  # Активация окружения
    ```

2. **Установка зависимостей:**
    Далее, установите все необходимые библиотеки из файла `requirements.txt`:
    ```bash
    pip install -r requirements.txt  # Установка зависимостей
    ```

3. **Запуск окружения:**
    При каждом запуске проекта, не забудьте активировать виртуальное окружение:
    ```bash
    source venv/bin/activate  # Активация окружения
    ```

### Установка на Windows

1. **Создание виртуального окружения:**
    Откройте командную строку и выполните следующие команды:
    ```bash
    python -m venv venv  # Создание виртуального окружения
    call venv\Scripts\activate  # Активация окружения
    ```

2. **Установка зависимостей:**
    Установите все необходимые библиотеки:
    ```bash
    pip install -r requirements.txt  # Установка зависимостей
    ```

3. **Запуск окружения:**
    Для активации окружения используйте следующую команду:
    ```bash
    call venv\Scripts\activate  # Активация окружения
    ```

## Запуск тренировки, валидации и оценки модели

1. **Запуск тренировки с использованием конфигурационного файла:**
    Для начала тренировки модели, укажите путь к конфигурационному файлу:
    ```bash
    python train.py -f configs/ocr_config.toml  # Запуск тренировки
    ```

2. **Запуск валидации:**
    Для выполнения валидации модели, укажите директорию с изображениями, файл с аннотациями и путь к предобученной модели:
    ```bash
    python val.py -f imgs -c val.csv -m checkpoints/pretrain.pth  # Запуск валидации
    ```

3. **Запуск оценки:**
    Для оценки модели на тестовых данных, укажите директорию с изображениями и путь к модели:
    ```bash
    python eval.py -f imgs -m checkpoints/pretrain.pth  # Запуск оценки
    ```

## Результаты работы модели

- **WER (Word Error Rate)**: 0.194 (~80.6%)
- **CER (Character Error Rate)**: 0.0994 (~90%)

Эти результаты демонстрируют высокий уровень точности модели при распознавании текста на ценниках при условие столь ограниченного датасета.

## Используемые решения

### Оптимизатор: [AdanSF](https://github.com/neosr-project/adan_schedule_free)

Оптимизатор **AdanSF** представляет собой модификацию популярного оптимизатора **Adan**, который использует подход **Schedule-Free** (SF). Этот метод исключает необходимость вручную изменять скорость обучения (learning rate, lr) на разных этапах тренировки, что существенно ускоряет процесс сходимости и делает обучение более стабильным. Использование **AdanSF** позволяет достичь оптимальных результатов без ручной настройки параметров.

- [Ссылка на проект AdanSF](https://github.com/neosr-project/adan_schedule_free)
- [Оригинальный проект Adan](https://github.com/sail-sg/Adan)
- [Документация по подходу Schedule-Free](https://github.com/facebookresearch/schedule_free)

### Архитектура и метод тренировки на основе [CRNN](https://arxiv.org/pdf/1507.05717)

Для распознавания текста на ценниках использована свёрточная рекуррентная нейронная сеть (CRNN), которая позволяет эффективно решать задачу распознавания текста с минимальными вычислительными затратами. CRNN сочетает в себе мощь свёрточных нейронных сетей для извлечения признаков и рекуррентных сетей (LSTM) для обработки последовательностей данных, таких как текст.

Использование **CTCLoss** позволяет эффективно обучать модель на данных с переменной длиной последовательности символов, что идеально подходит для OCR задач, где длина строк может варьироваться. В качестве основы использована **двунаправленная LSTM** (BiLSTM), что помогает учитывать контекст и улучшает распознавание.

Кроме того, использован модифицированный backbone под названием **MambaOut**, который представляет собой современный классификатор с улучшенным пространственным вниманием. Это внимание необходимо для точного распознавания текста, особенно на изображениях с различными искажениями, такими как ценники.

- [Документ по CRNN](https://arxiv.org/pdf/1507.05717)
- [Проект MambaOut](https://github.com/yuweihao/MambaOut)
